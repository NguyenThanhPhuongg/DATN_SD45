<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .container {
            display: flex;
            margin-left: auto;
            margin-right: auto;
            width: 1200px;
            background-color: #f0f0f0;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow */
            height: 1000px; /* Increase the height as needed */
            overflow: hidden; /* Prevent content from overflowing */
            position: relative; /* Ensure positioned children are contained */
        }

        /* CSS cho sidebar */
        .sidebar {
            width: auto; /* Chiều rộng tự động dựa trên nội dung */
            min-width: 200px; /* Chiều rộng tối thiểu */
            max-width: 300px; /* Chiều rộng tối đa */
            overflow: auto; /* Thêm cuộn nếu nội dung vượt quá chiều rộng tối đa */
            background-color: #f9f9f9; /* Màu nền cho sidebar */
            border: 1px solid #ddd; /* Viền cho sidebar */
            padding: 10px; /* Khoảng cách bên trong */
            box-sizing: border-box; /* Bao gồm cả padding và border trong chiều rộng và chiều cao */
        }


        .user-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .user-name {
            font-size: 18px;
            font-weight: bold;
        }

        .edit-profile {
            font-size: 12px;
            color: #007bff;
            cursor: pointer;
        }

        .sidebar a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: #333;
            margin-bottom: 5px;
        }

        .sidebar a:hover {
            background-color: #ff5722;
            color: #fff;
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            margin-left: 20px;
            background-color: #fff;
            height: 100%; /* Ensure it takes full height of the parent */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: auto; /* Add scroll if content overflows */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-group input[type="radio"] {
            width: auto;
        }

        .form-group .radio-group {
            display: flex;
            gap: 10px;
        }

        .form-group .radio-group label {
            display: inline;
        }

        .form-group button {
            padding: 10px 20px;
            background-color: #ff5722;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .form-group button:hover {
            background-color: #e64a19;
        }

        .form-group .dob-group {
            display: flex;
            gap: 10px;
        }

        .form-group .dob-group select {
            width: auto;
            flex-grow: 1;
        }

        .tabs {
            display: none;
        }

        .tabs.active {
            display: block;
        }

        .tabs ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
        }

        .tabs ul li {
            flex-grow: 1;
        }

        .tabs ul li a {
            text-decoration: none;
            padding: 15px;
            background-color: #f5f5f5;
            color: #333;
            display: block;
            text-align: center;
            border-radius: 5px;
            font-size: 16px;
        }

        .tabs ul li a:hover, .tabs ul li a.active {
            background-color: #ff5722;
            color: #fff;
        }

        .separator {
            height: 1px;
            background-color: #ccc;
            margin: 20px 0;
        }

        .profile-form-container {
            display: flex;
            justify-content: space-between;
            height: calc(100% - 100px);
        }

        .profile-form-container .form-section, .profile-form-container .profile-pic-section {
            flex: 1;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .profile-form-container .form-section {
            margin-right: 20px;
        }

        .profile-pic-section {
            text-align: center;
        }

        .profile-pic-section img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .sub-menu a:hover {
            background-color: #ff5722;
            color: #fff;
            font-size: 14px;
        }

        .sub-menu a {
            display: block;
            padding-left: 40px; /* Dịch chữ bên trong sang phải 20px */
            text-decoration: none;
            color: inherit;
        }


        .sidebar a.active, .sidebar a:hover {
            background-color: #ff5722;
            color: #fff;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            text-align: center;
            display: none;
            width: 200px;
        }

        .tabs {
            display: none;
        }

        .tabs.active {
            display: block;
        }

        .profile-form-container .form-section,
        .profile-form-container .profile-pic-section {
            flex: 1;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .address-list {
            margin-top: 20px;
        }

        .address-item h4 {
            margin: 0 0 5px 0;
            font-size: 18px;
            font-weight: normal;
        }

        .address-item p {
            margin: 0;
        }

        .address-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .address-item .default {
            display: inline-block;
            padding: 2px 6px;
            border: 1px solid #ff5722;
            border-radius: 4px;
            color: #ff5722;
            margin-left: 10px;
        }

        .address-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .address-info {
            flex-grow: 1;
        }

        .address-actions {
            display: flex;
            gap: 10px; /* Hiển thị các nút bên cạnh nhau */
            align-items: center;
        }

        button.edit-address-btn,
        button.delete-address-btn,
        button.default-address-btn {
            background-color: #fff; /* Khung không màu cam */
            color: #ff5722;
            border: 2px solid #ff5722;
            padding: 10px 20px;
            border-radius: 4px; /* Bo góc */
            cursor: pointer;
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            margin-left: 20px;
            background-color: #fff;
            height: 100%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Prevent content from overflowing */
            position: relative; /* Ensure positioned children are contained */
        }

        .order-contents {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Add vertical scroll if content overflows */
            border-radius: 8px;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%; /* Ensure it takes full width of the parent */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            max-height: 100%; /* Ensure it does not exceed the height of the parent */
            position: absolute; /* Position it within the content container */
        }

        .order-item {
            background-color: #f0f0f0; /* Màu xám nhạt */
            border-radius: 8px; /* Bo góc */
            padding: 15px; /* Khoảng cách bên trong */
            margin-bottom: 10px; /* Khoảng cách giữa các ô */
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Đổ bóng nhẹ */
            word-wrap: break-word; /* Ngắt từ khi quá dài */
            width: 100%; /* Chiều rộng đầy đủ */
            box-sizing: border-box; /* Bao gồm cả padding và border */
        }

        .order-item h3 {
            margin: 0; /* Loại bỏ khoảng cách mặc định của h4 và p */
            padding-bottom: 10px; /* Khoảng cách dưới mỗi đoạn */
            font-size: 18px; /* Tăng cỡ chữ */
            font-weight: normal; /* Không đậm chữ */
        }

        .order-item p {
            margin: 0; /* Loại bỏ khoảng cách mặc định của h4 và p */
            padding-bottom: 10px; /* Khoảng cách dưới mỗi đoạn */
        }

        .order-item .status {
            float: right; /* Dịch sang góc phải */
            color: red; /* Màu đỏ */
        }

        .order-item .classification {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-item .total {
            text-align: right; /* Dịch sang góc phải */
            color: red; /* Màu đỏ */
            margin-top: 10px; /* Khoảng cách trên */
            font-size: 18px;
        }

        .order-item .actions {
            margin-top: 15px; /* Khoảng cách trên cùng */
            display: flex;
            justify-content: space-between; /* Đặt các nút cách đều nhau */
        }

        .order-item .actions button {
            padding: 10px 20px; /* Khoảng cách bên trong nút */
            border: none; /* Bỏ viền */
            border-radius: 4px; /* Bo góc */
            cursor: pointer; /* Con trỏ chuột */
        }

        .order-item .actions .buy-again {
            background-color: #ff5722; /* Màu cam cho nút Mua lại */
            color: #fff; /* Màu chữ trắng */
        }

        .order-item .actions .cancel-details {
            background-color: #cccccc;
            color: #333; /* Màu chữ đen đậm */
        }

        .tab-link {
            text-decoration: none;
            color: #333; /* Default color */
            padding: 10px 20px;
            display: inline-block;
        }

        .tab-link.active {
            background-color: #ff5722; /* Màu cam cho tab đang chọn */
            color: #fff; /* Màu chữ trắng */
            border-radius: 4px; /* Bo góc */
        }

        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-radius: 8px;
            text-align: center;
            width: 30%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .confirm-dialog button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #confirm-yes {
            background-color: #ff5722;
            color: #fff;
        }

        #confirm-no {
            background-color: #f0f0f0;
            color: #333;
        }

        /* CSS cho form thêm mới địa chỉ */
        #add-address-form {
            background-color: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            width: 50%;
            margin: 20px auto;
        }

        #add-address-form h3 {
            margin-bottom: 20px;
        }

        #add-address-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        #add-address-form input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #add-address-form .error-message {
            color: red;
            margin-top: -10px;
            margin-bottom: 10px;
            font-size: 0.875em;
        }

        #add-address-form button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        #add-address-form button:first-of-type {
            background-color: #ff5722;
            color: #fff;
        }

        #add-address-form button:last-of-type {
            background-color: #f0f0f0;
            color: #333;
        }

        .refund {
            margin-left: auto;
            display: flex;
            align-items: center;
        }

        .refund-label {
            color: black;
            margin-right: 5px;
        }

        .refund-amount {
            color: red;
            font-size: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .user-name {
            font-size: 20px;
        }


        #orders-link {
            display: flex;
            align-items: center;

            #account-link, #orders-link {
                font-size: 16px; /* Đặt cỡ chữ */
            }

            font-size: 16px; /* Đặt cỡ chữ */
            text-decoration: none;
            color: inherit;
        }

        #orders-link .link-icon {
            width: 20px;
            height: 18px;
            margin-right: 8px; /* Khoảng cách giữa hình ảnh và văn bản */
        }

        #account-link {
            display: flex;
            align-items: center;
            font-size: 16px; /* Đặt cỡ chữ */
            text-decoration: none;
            color: inherit;
        }

        #account-link .link-icon {
            width: 20px;
            height: 18px;
            margin-right: 8px; /* Khoảng cách giữa hình ảnh và văn bản */
        }

        /* General order container */
        .order-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 20px;
        }

        /* Header of the order */
        .order-header {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .order-header h2 {
            font-size: 1.2em;
            margin: 0;
            color: #333;
        }

        .order-header .status {
            font-weight: bold;
            color: #ff5722;
        }

        /* Order items */
        .order-details {
            margin-bottom: 15px;
        }

        .order-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item h3 {
            font-size: 1.1em;
            margin: 0 0 10px;
        }

        .classification p {
            margin: 5px 0;
        }

        .price {
            font-weight: bold;
            color: #ff5722;
        }

        .total {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }

        /* Total amount section (below order details) */
        .order-total {
            font-size: 24px; /* Set font size to 24px */
            font-weight: bold;
            color: #f44336; /* Set color to red */
            margin-top: 20px; /* Create space before the total */
            text-align: right; /* Align the total amount to the right */
        }

        .order-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end; /* Align buttons to the right */
            gap: 10px; /* Add some space between buttons */
        }

        .order-actions button,
        .order-actions .cancel-order {
            background-color: #4caf50;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1em;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .order-actions button:hover {
            background-color: #45a049;
        }

        .order-actions .cancel-order {
            background-color: #ff5722;
        }

        .order-actions .cancel-order:hover {
            background-color: #e64a19;
        }

        /* Refund message */
        .refund {
            margin-top: 10px;
            font-size: 1.1em;
            color: #333;
        }

        .refund-label {
            font-weight: bold;
        }

        .refund-amount {
            color: #ff5722;
        }

        /* Style cho modal confirm cancel */
        #confirm-cancel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            font-family: Arial, sans-serif;
        }

        /* Overlay background (hiển thị mờ phía sau modal) */
        #confirm-cancel::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: -1;
        }

        /* Style cho phần tiêu đề của modal */
        #confirm-cancel-message {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        /* Style cho phần lựa chọn lý do hủy */
        #cancel-reason-container {
            text-align: left;
            margin-bottom: 20px;
            font-size: 16px;
        }

        /* Style cho mỗi label chứa radio button */
        #cancel-reason-container label {
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
            cursor: pointer;
            padding-left: 25px;
            position: relative;
        }

        /* Style cho các radio button */
        #cancel-reason-container input[type="radio"] {
            position: absolute;
            left: 0;
            top: 0;
            margin-top: 5px;
        }

        /* Style cho các nút xác nhận và hủy */
        #confirm-cancel-yes, #confirm-cancel-no {
            padding: 10px 20px;
            margin-top: 10px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        /* Style cho nút xác nhận */
        #confirm-cancel-yes {
            background-color: #4CAF50;
            color: white;
        }

        #confirm-cancel-yes:hover {
            background-color: #45a049;
        }

        /* Style cho nút hủy */
        #confirm-cancel-no {
            background-color: #f44336;
            color: white;
        }

        #confirm-cancel-no:hover {
            background-color: #e53935;
        }

        /* Đảm bảo modal không bị tràn ra ngoài khi có nội dung dài */
        #confirm-cancel button {
            font-size: 16px;
            padding: 10px 20px;
            margin-top: 20px;
        }

        /* Thiết lập responsive cho modal */
        @media (max-width: 600px) {
            #confirm-cancel {
                width: 90%;
            }
        }

        /* General modal styles */
        .cancel-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Transparent background */
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .-detail-modal-content {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.3s ease-out; /* Animation for fade-in effect */
        }

        /* Title styling */
        .-detail-modal-content h3 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        /* Product detail styling */
        .product-detail {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
        }

        .product-detail h4 {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 10px;
        }

        .product-detail p {
            font-size: 1rem;
            color: #777;
            margin: 5px 0;
        }

        /* Close button styling */
        #close-detail-cancel-modal {
            background-color: #ff5733; /* Red color for close button */
            color: white;
            font-size: 1rem;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }

        #close-detail-cancel-modal:hover {
            background-color: #e14a2b; /* Darker red on hover */
        }

        /* Animation for modal fade-in */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="../css/headerAll.css">
    <script src="/js/headerJs.js"></script>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<div th:include="header-all::body"></div>
<main>
    <div class="container">
        <div class="sidebar">
            <div class="user-info">
                <img src="" alt="User Icon" class="user-icon" id="user-avatar"/>
                <div class="user-name" id="user-name">Username</div>
            </div>

            <a href="#" id="account-link">
                <img src="https://down-vn.img.susercontent.com/file/ba61750a46794d8847c3f463c5e71cc4" alt="Icon"
                     class="link-icon">
                Tài khoản của tôi
            </a>
            <div class="sub-menu" id="account-submenu" style="display:none;">
                <a href="#" id="profile-link">Hồ sơ</a>
                <a href="#" id="change-password-link">Đổi mật khẩu</a>
                <a href="#" id="address-link">Địa chỉ</a>
                <a href="#">Tích điểm</a>
            </div>
            <a href="#" id="orders-link">
                <img src="https://down-vn.img.susercontent.com/file/f0049e9df4e536bc3e7f140d071e9078" alt="Icon"
                     class="link-icon">
                Đơn mua
            </a>

        </div>
        <div class="content">
            <div id="profile-form" class="tabs active">
                <h2>Hồ sơ của tôi</h2>
                <p>Quản lý thông tin hồ sơ để bảo mật tài khoản</p>
                <div class="separator"></div>
                <div class="profile-form-container">
                    <div class="form-section">
                        <div class="form-group">
                            <label for="username">Tên đăng nhập</label>
                            <input type="text" id="username" name="username" readonly>
                        </div>
                        <div class="form-group">
                            <label for="name">Tên</label>
                            <input type="text" id="name" name="name">
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="phone">Số điện thoại</label>
                            <input type="text" id="phone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="cccd">CCCD</label>
                            <input type="text" id="cccd" name="cccd">
                        </div>
                        <div class="form-group">
                            <label>Giới tính</label>
                            <div class="radio-group">
                                <label><input type="radio" name="gender" value="NAM"> Nam</label>
                                <label><input type="radio" name="gender" value="NU"> Nữ</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dob">Ngày sinh</label>
                            <input type="date" id="dob" name="dob">
                        </div>
                    </div>
                    <div class="profile-pic-section">
                        <img id="profile-pic-img" src="" alt="Avatar user">
                        <div class="form-group">
                            <label for="profile-pic">Ảnh đại diện</label>
                            <input type="file" id="profile-pic" name="profile-pic">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" id="update-button">Cập Nhật</button>
                </div>
            </div>
            <div id="password-form" class="tabs">
                <h2>Đổi Mật Khẩu</h2>
                <p>Đổi mật khẩu tài khoản của bạn</p>
                <div class="separator"></div>
                <form class="profile-form-container">
                    <div class="form-section">
                        <div class="form-group">
                            <label for="old-password">Mật khẩu cũ</label>
                            <input type="password" id="old-password" name="old-password">
                        </div>
                        <div class="form-group">
                            <label for="new-password">Mật khẩu mới</label>
                            <input type="password" id="new-password" name="new-password">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Xác nhận mật khẩu</label>
                            <input type="password" id="confirm-password" name="confirm-password">
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" id="change-password-button">Đổi Mật Khẩu</button>
                    </div>
                </form>
            </div>
            <div id="address-form" class="tabs">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Địa chỉ của tôi</h2>
                    <button type="button" id="add-address-button"
                            style="background-color: #ff5722; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                        Thêm địa chỉ mới
                    </button>
                </div>
                <div class="separator"></div>
                <div id="address-list" class="address-list">
                    <!-- Danh sách địa chỉ sẽ được hiển thị tại đây -->
                </div>
                <div id="add-address-form" style="display: none;">
                    <h3 id="form-title">Thêm mới địa chỉ</h3>
                    <label for="hoTen">Họ và tên:</label>
                    <input type="text" id="hoTen" name="hoTen"><br><br>
                    <label for="diaChi">Địa chỉ:</label>
                    <input type="text" id="diaChi" name="diaChi"><br><br>
                    <label for="sdt">Số điện thoại:</label>
                    <input type="text" id="sdt" name="sdt"><br><br>
                    <label for="thanhPho">Thành phố:</label>
                    <input type="text" id="thanhPho" name="thanhPho"><br><br>
                    <label for="quocGia">Quốc gia:</label>
                    <input type="text" id="quocGia" name="quocGia"><br><br>
                    <button id="save-button" onclick="submitNewAddress()">Lưu</button>
                    <button onclick="cancelNewAddress()">Hủy</button>
                </div>
                <!--                <div id="confirm-dialog" class="confirm-dialog" style="display: none;">-->
                <!--                    <p id="confirm-message">Bạn có chắc chắn muốn thực hiện hành động này không?</p>-->
                <!--                    <button id="confirm-yes">Có</button>-->
                <!--                    <button id="confirm-no">Không</button>-->
                <!--                </div>-->
            </div>

            <div id="orders-tabs" class="tabs">
                <div class="tab-links">
                    <ul>
                        <li><a href="#" class="tab-link" data-status="null">Tất cả</a></li>
                        <li><a href="#" class="tab-link" data-status="0">Chờ xác nhận</a></li>
                        <li><a href="#" class="tab-link" data-status="1">Chờ thanh toán</a></li>
                        <li><a href="#" class="tab-link" data-status="2">Chờ giao hàng</a></li>
                        <li><a href="#" class="tab-link" data-status="3">Vận chuyển</a></li>
                        <li><a href="#" class="tab-link" data-status="4">Hoàn thành</a></li>
                        <li><a href="#" class="tab-link" data-status="5">Đã hủy</a></li>
                        <li><a href="#" class="tab-link" data-status="6">Trả hàng/Hoàn tiền</a></li>
                    </ul>
                </div>
                <div id="order-contents" class="order-contents">
                    <!-- Thông tin đơn hàng sẽ được hiển thị tại đây -->
                </div>
            </div>

        </div>
    </div>
</main>
<div id="notification" class="notification"></div>
<div id="confirm-dialog" class="confirm-dialog" style="display: none;">
    <p id="confirm-message">Bạn có chắc chắn muốn thực hiện hành động này không?</p>
    <button id="confirm-yes">Có</button>
    <button id="confirm-no">Không</button>
</div>
<div id="confirm-cancel" class="confirm-dialog" style="display: none;">
    <h2 id="confirm-cancel-message">Lý do huỷ:</h2>
    <div id="cancel-reason-container">
        <label>
            <input type="radio" name="cancel-reason" value="Tôi muốn cập nhật địa chỉ/sđt nhận hàng">
            Tôi muốn cập nhật địa chỉ/sđt nhận hàng
        </label><br>
        <label>
            <input type="radio" name="cancel-reason" value="Tôi muốn thêm, thay đổi mã giảm giá">
            Tôi muốn thêm, thay đổi mã giảm giá
        </label><br>
        <label>
            <input type="radio" name="cancel-reason"
                   value="Tôi muốn thay đổi sản phẩm( kích thước, màu sắc, số lượng...)">
            Tôi muốn thay đổi sản phẩm( kích thước, màu sắc, số lượng...)
        </label><br>
        <label>
            <input type="radio" name="cancel-reason" value="Thủ tục thanh toán rắc rối">
            Thủ tục thanh toán rắc rối
        </label><br>
        <label>
            <input type="radio" name="cancel-reason"
                   value="Tôi tìm thấy chỗ mua khác tốt hơn( rẻ hơn, uy tín, giao nhanh hơn ...)">
            Tôi tìm thấy chỗ mua khác tốt hơn( rẻ hơn, uy tín, giao nhanh hơn ...)
        </label><br>
        <label>
            <input type="radio" name="cancel-reason" value="Tôi không có nhu cầu mua nữa">
            Tôi không có nhu cầu mua nữa
        </label><br>
        <label>
            <input type="radio" name="cancel-reason" value="Tôi không tìm thấy lý do hủy phù hợp">
            Tôi không tìm thấy lý do hủy phù hợp
        </label>
    </div>

    <button id="confirm-cancel-yes">Xác nhận</button>
    <button id="confirm-cancel-no">Hủy</button>
</div>
<!-- Modal để hiển thị chi tiết hủy đơn -->
<div id="cancel-detail-modal" class="cancel-detail-modal" style="display: none;">
    <div class="-detail-modal-content">
        <h3>Chi tiết hủy đơn</h3>
        <div id="cancel-details-content"></div> <!-- Phần nội dung chi tiết sản phẩm sẽ được cập nhật ở đây -->
        <button id="close-detail-cancel-modal" onclick="closeCancelModal()">Đóng</button>
    </div>
</div>



<div th:include="footer::body"></div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
<script>
    let diaChiIdToHandle = null; // Biến lưu trữ ID địa chỉ cho hành động cần thực hiện
    let confirmAction = null; // Biến lưu trữ loại hành động cần xác nhận
    let isEditing = false;


    // Hàm để lấy và giải mã token
    function parseJwt(token) {
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        } catch (error) {
            console.error('Lỗi khi giải mã token:', error);
            return null;
        }
    }

    // Hàm để cập nhật thông tin người dùng
    // function updateUserInfo() {
    //     const token = localStorage.getItem('token');
    //     const userInfo = parseJwt(token);
    //
    //     if (userInfo) {
    //         const userName = userInfo.fullName;
    //
    //         document.getElementById('user-name').innerText = userName;
    //     }
    // }

    // Gọi hàm updateUserInfo để cập nhật thông tin người dùng khi trang tải
    // document.addEventListener('DOMContentLoaded', updateUserInfo);

    document.getElementById('account-link').addEventListener('click', function () {
        var submenu = document.getElementById('account-submenu');
        if (submenu.style.display === 'none' || submenu.style.display === '') {
            submenu.style.display = 'block';
        } else {
            submenu.style.display = 'none';
        }
    });

    document.getElementById('profile-link').addEventListener('click', function () {
        document.getElementById('profile-form').classList.add('active');
        document.getElementById('orders-tabs').classList.remove('active');
        document.getElementById('password-form').classList.remove('active');
        document.getElementById('address-form').classList.remove('active');
    });


    document.getElementById('orders-link').addEventListener('click', function () {
        document.getElementById('profile-form').classList.remove('active');
        document.getElementById('orders-tabs').classList.add('active');
        document.getElementById('password-form').classList.remove('active');
        document.getElementById('address-form').classList.remove('active');
    });

    // Gán sự kiện click cho tất cả các tab
    document.querySelectorAll('.tab-link').forEach(tab => {
        tab.addEventListener('click', function (event) {
            event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
            let status = this.dataset.status; // Lấy giá trị trạng thái từ thuộc tính data-status
            status = status === "null" ? null : parseInt(status, 10); // Chuyển đổi giá trị về kiểu số nguyên hoặc null
            fetchOrderData(status); // Gọi hàm lấy dữ liệu đơn hàng theo trạng thái
            // Xóa class active từ các tab khác
            document.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
            // Thêm class active vào tab hiện tại
            this.classList.add('active');
        });
    });

    // Hàm để lấy dữ liệu đơn hàng từ API
    async function fetchOrderData(status) {
        const token = localStorage.getItem('token'); // Lấy token từ localStorage
        const response = await fetch('/rest/hoadon/get-list-by-status', {
            method: 'POST', // Sử dụng phương thức POST
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}` // Thêm token vào header Authorization
            },
            body: JSON.stringify({status}) // Gửi đối tượng JSON với thuộc tính status
        });

        if (response.ok) {
            const result = await response.json(); // Chuyển đổi phản hồi thành JSON
            displayOrderData(result.data); // Hiển thị dữ liệu đơn hàng
        } else {
            console.error('Lỗi khi gọi API lấy dữ liệu đơn hàng.'); // Hiển thị lỗi nếu có
        }
    }


    // Định nghĩa các trạng thái và mô tả tương ứng
    const trangThaiMap = {
        0: 'CHỜ XÁC NHẬN',
        1: 'CHỜ THANH TOÁN',
        2: 'CHỜ GIAO HÀNG',
        3: 'VẬN CHUYỂN',
        4: 'HOÀN THÀNH',
        5: 'ĐÃ HỦY',
        6: 'ĐÃ HOÀN TIỀN'
    };

    // Hàm để hiển thị dữ liệu đơn hàng lên giao diện
    function displayOrderData(orderList) {
        const orderContents = document.getElementById('order-contents');
        orderContents.innerHTML = ''; // Clear previous content

        if (orderList && orderList.length > 0) {
            orderList.forEach(order => {
                // Create a container for the entire order
                const orderContainer = document.createElement('div');
                orderContainer.classList.add('order-container'); // Class for styling the whole order

                // Create order header
                const orderHeader = document.createElement('div');
                orderHeader.classList.add('order-header');
                orderHeader.innerHTML = `
                <h2>Mã đơn hàng: ${order.ma}</h2>
                <span class="status">${trangThaiMap[order.trangThai] || 'Không xác định'}</span>
            `;
                orderContainer.appendChild(orderHeader);

                // Create order details
                const orderDetails = document.createElement('div');
                orderDetails.classList.add('order-details');


                // Add order items
                order.hoaDonChiTietModels.forEach((hdct, index) => {
                    const orderItem = document.createElement('div');
                    orderItem.classList.add('order-item');

                    const thanhTien = hdct.soLuong * hdct.gia;
                    orderItem.innerHTML = `
                    <h3>
                        <img src="images/${hdct.sanPhamChiTietModel.sanPhamModel.anh}" alt="" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
                        ${hdct.sanPhamChiTietModel.sanPhamModel.ten}
                    </h3>
                    <div class="classification">
                        <p>Phân loại hàng: màu ${hdct.sanPhamChiTietModel.mauSac.ten}, size ${hdct.sanPhamChiTietModel.size.ten}</p>
                        <p class="price">₫${hdct.gia}</p>
                    </div>
                    <p>x${hdct.soLuong}</p>
                `;
                    orderDetails.appendChild(orderItem);

                    // Add a horizontal line between order items, except the last one
                    if (index < order.hoaDonChiTietModels.length - 1) {
                        const separator = document.createElement('hr');
                        orderDetails.appendChild(separator);
                    }
                });

                // Create the total amount div (placed below the order details)
                const totalDiv = document.createElement('div');
                totalDiv.classList.add('order-total');
                totalDiv.innerHTML = `<strong>Tổng cộng: ₫${order.tongTien}</strong>`;
                orderContainer.appendChild(orderDetails); // Add the order details first
                orderContainer.appendChild(totalDiv); // Then add the total amount after details

                // Create actions section outside the order-items
                const orderActions = document.createElement('div');
                orderActions.classList.add('order-actions');

                // Add action buttons based on order status
                orderActions.innerHTML = `
                ${order.trangThai === 4 || order.trangThai === 5 ? '<button class="buy-again">Mua lại</button>' : ''}
               ${order.trangThai === 5 ?
                    `<button class="cancel-details" onclick="showCancelDetailsModal(${order.id})">Xem chi tiết hủy đơn</button>`
                    : ''}

               ${order.trangThai === 1 || order.trangThai === 0
                    ? `<button onclick="showCancelConfirmDialog(${order.id})" class="cancel-order" style="background-color: #ff5722; color: #fff;">Hủy đơn hàng</button>`
                    : ''}

                ${order.trangThai === 6 ? `<div class="refund"><span class="refund-label">Số tiền hoàn lại:</span> <span class="refund-amount">₫${order.tongTien}</span></div>` : ''}
            `;
                orderContainer.appendChild(orderActions); // Add the actions (buy again, cancel, etc.)

                // Add the entire order container to the orderContents
                orderContents.appendChild(orderContainer);
            });
        } else {
            orderContents.innerHTML = '<p>Không có đơn hàng nào.</p>'; // Display message if no orders
        }
    }

    // Gọi dữ liệu đơn hàng khi tab "Tất cả" được kích hoạt lần đầu
    document.querySelector('.tab-link[data-status="null"]').classList.add('active');
    fetchOrderData(null);

    document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', function () {
            document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Hàm để gọi API lấy dữ liệu người dùng
    async function layDuLieuNguoiDung(token) {
        const response = await fetch('user/get', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        if (response.ok) {
            const data = await response.json();
            return data;
        } else {
            console.error('Lỗi khi lấy dữ liệu người dùng');
        }
    }

    // Hàm để gán thông tin vào form hồ sơ cá nhân
    async function ganThongTinVaoForm() {
        const token = localStorage.getItem('token');
        if (token) {
            const duLieuNguoiDung = await layDuLieuNguoiDung(token);
            if (duLieuNguoiDung) {
                const profile = duLieuNguoiDung.data.profile;
                document.getElementById('username').value = duLieuNguoiDung.data.userName || '';
                document.getElementById('name').value = profile.hoVaTen || '';
                document.getElementById('email').value = profile.email || '';
                document.getElementById('phone').value = profile.phone || '';
                document.getElementById('cccd').value = profile.cccd || '';
                document.getElementById('dob').value = profile.ngaySinh || '';
                const avatarImg = document.getElementById('profile-pic-img');
                if (profile.avatar) {
                    avatarImg.src = `${profile.avatar}`;
                    document.getElementById('user-avatar').src = profile.avatar;
                }
                document.getElementById('user-name').innerText = profile.hoVaTen;
                // Xử lý giới tính
                if (profile.gioiTinh === 'NAM') {
                    document.querySelector('input[name="gender"][value="NAM"]').checked = true;
                } else if (profile.gioiTinh === 'NU') {
                    document.querySelector('input[name="gender"][value="NU"]').checked = true;
                }

            }
        }
    }

    // Gọi hàm ganThongTinVaoForm khi trang được tải
    window.onload = ganThongTinVaoForm;


    // Hàm hiển thị thông báo
    function hienThiThongBao(message, success = true) {
        const notification = document.getElementById('notification');
        notification.innerText = message;
        notification.style.backgroundColor = success ? 'rgba(0, 128, 0, 0.8)' : 'rgba(255, 0, 0, 0.8)';
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    // Hàm để lấy giá trị từ form và tạo yêu cầu cập nhật
    function updateRequest() {
        return {
            hoVaTen: document.getElementById('name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            cccd: document.getElementById('cccd').value,
            gioiTinh: document.querySelector('input[name="gender"]:checked')?.value || null,
            ngaySinh: document.getElementById('dob').value
        };
    }

    async function updateProfile(request) {
        const token = localStorage.getItem('token');

        const formData = new FormData();

        formData.append('request', JSON.stringify(request));

        const fileInput = document.getElementById('profile-pic');
        const file = fileInput.files[0];
        if (file) {
            formData.append('file', file);
        }

        const response = await fetch('profile/update', {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });

        if (response.ok) {
            const data = await response.json();
            hienThiThongBao('Cập nhật thành công!', true);
            window.location.reload();
        } else {
            hienThiThongBao('Có lỗi xảy ra khi cập nhật thông tin.', false);
        }
    }


    // Gán sự kiện click cho nút Cập Nhật
    document.getElementById('update-button').addEventListener('click', function (event) {
        event.preventDefault();
        const request = updateRequest();
        updateProfile(request);
    });

    // Gán sự kiện click cho liên kết "Đổi mật khẩu"
    document.getElementById('change-password-link').addEventListener('click', function () {
        document.getElementById('profile-form').classList.remove('active');
        document.getElementById('orders-tabs').classList.remove('active');
        document.getElementById('password-form').classList.add('active');
        document.getElementById('address-form').classList.remove('active');
    });

    // Hàm để gọi API đổi mật khẩu
    async function doiMatKhau(request) {
        const token = localStorage.getItem('token');
        const response = await fetch('/auth/change-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(request)
        });
        if (response.ok) {
            hienThiThongBao('Đổi mật khẩu thành công!', true);
            // Clear the password form
            document.getElementById('old-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            // Chuyển trở lại form hồ sơ và áp dụng hiệu ứng hover
            document.getElementById('password-form').classList.remove('active');
            document.getElementById('profile-form').classList.add('active');
            document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));
            document.getElementById('profile-link').classList.add('active');
        } else {
            hienThiThongBao('Có lỗi xảy ra khi đổi mật khẩu.', false);
        }
    }

    // Gán sự kiện click cho nút "Đổi mật khẩu"
    document.getElementById('change-password-button').addEventListener('click', function (event) {
        event.preventDefault();
        const oldPassword = document.getElementById('old-password').value;
        const password = document.getElementById('new-password').value;
        const retypePassword = document.getElementById('confirm-password').value;

        // Kiểm tra mật khẩu mới và xác nhận mật khẩu có khớp nhau không
        if (password !== retypePassword) {
            hienThiThongBao('Mật khẩu mới và xác nhận mật khẩu không khớp.', false);
            return;
        }

        // Tạo đối tượng yêu cầu đổi mật khẩu và gọi hàm doiMatKhau
        const request = {oldPassword, password, retypePassword};
        doiMatKhau(request);
    });

    // Hàm để gọi API lấy danh sách địa chỉ
    async function layDanhSachDiaChi() {
        const token = localStorage.getItem('token');
        const response = await fetch('/dia-chi/get-list', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        if (response.ok) {
            const data = await response.json();
            return data.data; // Điều chỉnh theo cấu trúc phản hồi API của bạn
        } else {
            console.error('Lỗi khi lấy danh sách địa chỉ');
        }
    }

    // Hàm để hiển thị danh sách địa chỉ
    async function hienThiDanhSachDiaChi() {
        const diaChiList = await layDanhSachDiaChi();
        const addressListContainer = document.getElementById('address-list');
        addressListContainer.innerHTML = ''; // Xóa nội dung cũ

        if (diaChiList && diaChiList.length > 0) {
            diaChiList.forEach(diaChi => {
                const addressItem = document.createElement('div');
                addressItem.classList.add('address-item');
                const isDefault = diaChi.trangThai === 1;
                addressItem.innerHTML = `
                <div class="address-content">
                    <div class="address-info">
                        <h4>${diaChi.hoTen} | ${diaChi.sdt} ${isDefault ? '<span class="default">Mặc định</span>' : ''}</h4>
                        <p>${diaChi.diaChi}</p>
                        <p>${diaChi.thanhPho}, ${diaChi.quocGia}</p>
                    </div>
                    <div class="address-actions">
                        <button class="edit-address-btn" onclick="chinhSuaDiaChi(${diaChi.id})">Chỉnh sửa</button>
                        <button class="delete-address-btn" onclick="hienThiXacNhanHanhDong(${diaChi.id}, 'delete')">Xóa</button>
                        <button class="default-address-btn" style="${isDefault ? 'display: none;' : ''}" onclick="hienThiXacNhanHanhDong(${diaChi.id}, 'default')">Thiết lập mặc định</button>
                    </div>
                </div>
            `;
                addressListContainer.appendChild(addressItem);
            });
        } else {
            addressListContainer.innerHTML = '<p>Không có địa chỉ nào.</p>';
        }
    }


    // Gọi hàm hiển thị danh sách địa chỉ khi form "Địa chỉ" được kích hoạt
    document.getElementById('address-link').addEventListener('click', function () {
        document.getElementById('profile-form').classList.remove('active');
        document.getElementById('password-form').classList.remove('active');
        document.getElementById('orders-tabs').classList.remove('active');
        document.getElementById('address-form').classList.add('active');
        hienThiDanhSachDiaChi();
    });

    // Gán sự kiện click cho nút "Thêm địa chỉ mới"
    document.getElementById('add-address-button').addEventListener('click', function () {
        document.getElementById('address-list').style.display = 'none'; // Ẩn danh sách địa chỉ
        document.getElementById('add-address-form').style.display = 'block'; // Hiển thị form thêm mới
    });

    // Đảm bảo rằng DOM đã tải xong trước khi gán sự kiện
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('add-address-button').addEventListener('click', function () {
            document.getElementById('address-list').style.display = 'none'; // Ẩn danh sách địa chỉ
            document.getElementById('add-address-form').style.display = 'block'; // Hiển thị form thêm mới
            document.getElementById('form-title').innerText = 'Thêm mới địa chỉ';
            document.getElementById('save-button').onclick = submitNewAddress;
            isEditing = false; // Đặt lại trạng thái
        });

        document.getElementById('confirm-yes').addEventListener('click', xacNhanHanhDong);
        document.getElementById('confirm-no').addEventListener('click', function () {
            document.getElementById('confirm-dialog').style.display = 'none';
            diaChiIdToHandle = null; // Reset biến lưu trữ ID
            confirmAction = null; // Reset biến lưu trữ hành động
        });
    });


    // Hàm để xóa địa chỉ
    async function xoaDiaChi() {
        if (diaChiIdToHandle !== null) {
            const response = await fetch(`/dia-chi/${diaChiIdToHandle}`, {
                method: 'DELETE'
            });
            if (response.ok) {
                hienThiThongBao('Địa chỉ đã được xóa thành công!');
                hienThiDanhSachDiaChi(); // Cập nhật lại danh sách địa chỉ sau khi xóa thành công
            } else {
                hienThiThongBao('Lỗi khi xóa địa chỉ, vui lòng kim tra lại!', false);
            }
            document.getElementById('confirm-dialog').style.display = 'none';
            diaChiIdToHandle = null; // Reset biến lưu trữ ID
        }
    }

    // Hàm để thiết lập địa chỉ mặc định
    async function thietLapMacDinh() {
        if (diaChiIdToHandle !== null) {
            const response = await fetch(`/dia-chi/change/${diaChiIdToHandle}`, {
                method: 'PUT'
            });
            if (response.ok) {
                hienThiThongBao('Địa chỉ đã được thiết lập mặc định!');
                hienThiDanhSachDiaChi(); // Cập nhật lại danh sách địa chỉ sau khi thay đổi mặc định thành công
            } else {
                console.error('Lỗi khi thiết lập địa chỉ mặc định');
                hienThiThongBao('Lỗi khi thiết lập địa chỉ mặc định, vui lòng kim tra lại!', false);
            }
            document.getElementById('confirm-dialog').style.display = 'none';
            diaChiIdToHandle = null; // Reset biến lưu trữ ID
        }
    }

    // Hàm để hiển thị thông báo xác nhận dùng chung
    function hienThiXacNhanHanhDong(id, action) {
        diaChiIdToHandle = id;
        confirmAction = action;
        let message = 'Bạn có chắc chắn muốn thực hiện hành động này không?';
        if (action === 'default') {
            message = 'Bạn có chắc chắn muốn thiết lập địa chỉ này làm mặc định không?';
        } else if (action === 'delete') {
            message = 'Bạn có chắc chắn muốn xóa địa chỉ này không?';
        }
        document.getElementById('confirm-message').innerText = message;
        document.getElementById('confirm-dialog').style.display = 'block';
    }

    // Hàm để xử lý hành động xác nhận
    function xacNhanHanhDong() {
        if (confirmAction === 'default') {
            thietLapMacDinh();
        } else if (confirmAction === 'delete') {
            xoaDiaChi();
        }
    }

    // Gán sự kiện cho các nút xác nhận
    document.getElementById('confirm-yes').addEventListener('click', xacNhanHanhDong);
    document.getElementById('confirm-no').addEventListener('click', function () {
        document.getElementById('confirm-dialog').style.display = 'none';
        diaChiIdToHandle = null; // Reset biến lưu trữ ID
        confirmAction = null; // Reset biến lưu trữ hành động
    });

    document.getElementById('add-new-address-btn').addEventListener('click', function () {
        document.getElementById('address-list').style.display = 'none'; // Ẩn danh sách địa chỉ
        document.getElementById('add-address-form').style.display = 'block'; // Hiển thị form thêm mới
    });


    // Hàm để hủy thêm mới địa chỉ
    function cancelNewAddress() {
        document.getElementById('add-address-form').style.display = 'none'; // Ẩn form thêm mới
        document.getElementById('add-address-button').style.display = 'block';
        document.getElementById('address-list').style.display = 'block'; // Hiển thị lại danh sách địa chỉ
        clearFormErrors(); // Xóa tất cả lỗi
        document.getElementById('hoTen').value = '';
        document.getElementById('diaChi').value = '';
        document.getElementById('sdt').value = '';
        document.getElementById('thanhPho').value = '';
        document.getElementById('quocGia').value = '';
    }

    // Hàm để xóa tất cả lỗi khi hủy
    function clearFormErrors() {
        const errorElements = document.querySelectorAll('.error-message');
        errorElements.forEach(el => el.remove());
    }

    // Hàm xử lý khi gửi form thêm mới địa chỉ
    async function submitNewAddress() {
        // Xóa tất cả lỗi trước khi kiểm tra mới
        clearFormErrors();

        // Lấy giá trị từ các input
        const hoTen = document.getElementById('hoTen').value.trim();
        const diaChi = document.getElementById('diaChi').value.trim();
        const sdt = document.getElementById('sdt').value.trim();
        const thanhPho = document.getElementById('thanhPho').value.trim();
        const quocGia = document.getElementById('quocGia').value.trim();

        let valid = true;

        // Kiểm tra hợp lệ
        if (!hoTen || hoTen.length > 100) {
            showError('hoTen', 'Họ tên không được để trống và không vượt quá 100 ký tự.');
            valid = false;
        }
        if (!sdt || sdt.length < 10 || sdt.length > 15) {
            showError('sdt', 'Số điện thoại phải có từ 10 đến 15 ký tự.');
            valid = false;
        }
        if (!diaChi) {
            showError('diaChi', 'Địa chỉ không được để trống.');
            valid = false;
        }
        if (!thanhPho) {
            showError('thanhPho', 'Thành phố không được để trống.');
            valid = false;
        }
        if (!quocGia) {
            showError('quocGia', 'Quốc gia không được để trống.');
            valid = false;
        }

        if (!valid) return;

        const newAddress = {
            hoTen,
            diaChi,
            sdt,
            thanhPho,
            quocGia
        };

        // Gọi API tương ứng dựa trên trạng thái (thêm mới hoặc chỉnh sửa)
        let response;
        if (isEditing) {
            response = await fetch(`/dia-chi/${diaChiIdToHandle}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(newAddress)
            });
        } else {
            response = await fetch('/dia-chi/insert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(newAddress)
            });
        }

        // Xử lý phản hồi từ API
        if (response.ok) {
            hienThiThongBao(isEditing ? 'Địa chỉ đã được cập nhật thành công!' : 'Địa chỉ mới đã được thêm thành công!');
            // Xóa các giá trị đã nhập trong form sau khi thêm thành công
            document.getElementById('hoTen').value = '';
            document.getElementById('diaChi').value = '';
            document.getElementById('sdt').value = '';
            document.getElementById('thanhPho').value = '';
            document.getElementById('quocGia').value = '';
            cancelNewAddress(); // Ẩn form và hiển thị lại danh sách địa chỉ
            hienThiDanhSachDiaChi(); // Cập nhật lại danh sách địa chỉ
        } else {
            console.error('Lỗi khi thêm hoặc cập nhật địa chỉ');
            const errorData = await response.json();
            hienThiThongBao(`Lỗi: ${errorData.message}`);
        }
    }

    async function chinhSuaDiaChi(id) {
        // Hiển thị form trước khi gọi API lấy thông tin địa chỉ
        document.getElementById('address-list').style.display = 'none'; // Ẩn danh sách địa chỉ
        document.getElementById('add-address-form').style.display = 'block'; // Hiển thị form thêm mới
        document.getElementById('form-title').innerText = 'Chỉnh sửa địa chỉ';
        document.getElementById('save-button').onclick = submitNewAddress;
        document.getElementById('add-address-button').style.display = 'none';
        isEditing = true;
        diaChiIdToHandle = id;

        const response = await fetch(`/dia-chi/${id}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });

        if (response.ok) {
            const data = await response.json();
            const diaChi = data.data;
            document.getElementById('hoTen').value = diaChi.hoTen;
            document.getElementById('diaChi').value = diaChi.diaChi;
            document.getElementById('sdt').value = diaChi.sdt;
            document.getElementById('thanhPho').value = diaChi.thanhPho;
            document.getElementById('quocGia').value = diaChi.quocGia;
        } else {
            console.error('Lỗi khi lấy thông tin địa chỉ');
        }
    }


    // Hàm để hiển thị thông báo lỗi dưới input
    function showError(inputId, message) {
        const inputElement = document.getElementById(inputId);
        const errorElement = document.createElement('div');
        errorElement.className = 'error-message';
        errorElement.style.color = 'red';
        errorElement.textContent = message;
        inputElement.parentNode.appendChild(errorElement);
    }

    // Function to show the confirmation dialog
    function showCancelConfirmDialog(orderId) {
        document.getElementById('confirm-cancel').style.display = 'block';
        document.getElementById('confirm-cancel-yes').onclick = function () {
            const orderInfo = getSelectedCancelReason();
            if (orderInfo) {
                cancelOrder(orderId, orderInfo);
            } else {
                hienThiThongBao('Vui lòng chọn lý do hủy.', false);
            }
        };
        document.getElementById('confirm-cancel-no').onclick = function () {
            document.getElementById('confirm-cancel').style.display = 'none';
            resetCancelReasonSelection();
        };
    }

    function resetCancelReasonSelection() {
        const cancelReasonRadios = document.getElementsByName('cancel-reason');
        for (let i = 0; i < cancelReasonRadios.length; i++) {
            cancelReasonRadios[i].checked = false;
        }
    }

    function getSelectedCancelReason() {
        const cancelReasonRadios = document.getElementsByName('cancel-reason');
        for (let i = 0; i < cancelReasonRadios.length; i++) {
            if (cancelReasonRadios[i].checked) {
                return cancelReasonRadios[i].value;
            }
        }
        return null;
    }


    // Function to call the cancel order API
    async function cancelOrder(orderId, orderInfo) {
        const token = localStorage.getItem('token');
        const response = await fetch(`/rest/hoadon/cancel/${orderId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({orderInfo})
        });

        if (response.ok) {
            const result = await response.json();
            hienThiThongBao('Đơn hàng đã được hủy thành công!', true);
            document.getElementById('confirm-cancel').style.display = 'none'; // Ẩn modal
            resetCancelReasonSelection();
            fetchOrderDataForActiveTab(); // Refresh the order list for the active tab
        } else {
            hienThiThongBao('Có lỗi xảy ra khi hủy đơn hàng.', false);
        }
    }

    // Function to fetch order data for the currently active tab
    function fetchOrderDataForActiveTab() {
        const activeTab = document.querySelector('.tab-link.active');
        if (activeTab) {
            let status = activeTab.dataset.status;
            status = status === "null" ? null : parseInt(status, 10);
            fetchOrderData(status);
        }
    }

    // Hàm để hiển thị chi tiết hủy đơn trong modal
    function showCancelDetailsModal(orderId) {
        fetch(`rest/hoadon/get/${orderId}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`  // Gửi token nếu cần
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.code === "200") {
                    const cancelDetailsContent = document.getElementById('cancel-details-content');
                    const orderDetails = data.data; // Dữ liệu trả về từ API

                    let contentHTML = '';

                    // Lặp qua các chi tiết sản phẩm và tạo HTML
                    orderDetails.hoaDonChiTietModels.forEach(item => {
                        contentHTML += `
                    <div class="product-detail">
                        <img src="images/${item.sanPhamChiTietModel.sanPhamModel.anh}" alt="${item.sanPhamChiTietModel.sanPhamModel.ten}" />
                        <div class="product-info">
                            <h4>${item.sanPhamChiTietModel.sanPhamModel.ten}</h4>
                            <p>Size: ${item.sanPhamChiTietModel.size.ten}</p>
                            <p>Màu sắc: ${item.sanPhamChiTietModel.mauSac.ten}</p>
                            <p>Số lượng: ${item.soLuong}</p>
                            <p class="price">Giá: ₫${item.gia}</p>
                        </div>
                    </div>
                `;
                    });

                    // Add reason for cancellation section
                    contentHTML += `
                    <div id="cancel-reason">
                        <h5>Lý do hủy đơn:</h5>
                        <p>${orderDetails.lyDoHuy || 'Chưa có lý do'}</p>
                    </div>
                `;

                    // Cập nhật nội dung chi tiết vào modal
                    cancelDetailsContent.innerHTML = contentHTML;

                    // Hiển thị modal
                    document.getElementById('cancel-detail-modal').style.display = 'block';
                } else {
                    hienThiThongBao('Không tìm thấy thông tin chi tiết.', false);
                }
            })
            .catch(error => {
                console.error('Error fetching cancel details:', error);
                hienThiThongBao('Có lỗi xảy ra khi tải thông tin chi tiết.', false);
            });
    }

    // Hàm để đóng modal
    function closeCancelModal() {
        // Ẩn modal khi nhấn nút "Đóng"
        document.getElementById('cancel-detail-modal').style.display = 'none';
    }


</script>
</body>
</html>
